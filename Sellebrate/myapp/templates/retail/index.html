{% extends "retail/base.html" %}

{% block title %}Dashboard - Sellebrate{% endblock %}

{% block content %}
<div class="jumbotron">
    <h1 class="display-4">Welcome to Sellebrate!</h1>
    <p class="lead">Your one-stop database for retail management</p>
    <hr class="my-4">
    {% if insights %}
    <div class="row">
        <div class="col-md-3">
            <div class="card text-white bg-primary mb-3">
                <div class="card-header">Total Sales</div>
                <div class="card-body">
                    <h5 class="card-title">${{ insights.total_sales }}</h5>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-secondary mb-3">
                <div class="card-header">Total Orders</div>
                <div class="card-body">
                    <h5 class="card-title">{{ insights.total_orders }}</h5>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-success mb-3">
                <div class="card-header">Total Products</div>
                <div class="card-body">
                    <h5 class="card-title">{{ insights.total_products }}</h5>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-white bg-danger mb-3">
                <div class="card-header">Total Stock</div>
                <div class="card-body">
                    <h5 class="card-title">{{ insights.total_stock }}</h5>
                </div>
            </div>
        </div>
    </div>
    
    <h2>Total Sales and Quantity Sold by Product</h2>
    <table class="table table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Product ID</th>
                <th>Product Name</th>
                <th>Total Units Sold</th>
                <th>Total Sales ($)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in insights.total_sales_data %}
            <tr>
                <td>{{ item.ProductID }}</td>
                <td>{{ item.ProductName }}</td>
                <td>{{ item.TotalUnitsSold }}</td>
                <td>{{ item.TotalSales }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Best Selling Products Per Category</h2>
    <table class="table table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Category</th>
                <th>Product ID</th>
                <th>Product Name</th>
                <th>Total Sales ($)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in insights.best_selling_per_category %}
            <tr>
                <td>{{ item.Category }}</td>
                <td>{{ item.ProductID }}</td>
                <td>{{ item.ProductName }}</td>
                <td>{{ item.TotalSales }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Total Sales Per Product Category</h2>
    <table class="table table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Category</th>
                <th>Total Sales ($)</th>
            </tr>
        </thead>
        <tbody>
            {% for item in insights.total_sales_per_category %}
            <tr>
                <td>{{ item.Category }}</td>
                <td>{{ item.TotalSales }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Products Not Sold in the Last Month</h2>
    <table class="table table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Product ID</th>
                <th>Product Name</th>
                <th>Category</th>
            </tr>
        </thead>
        <tbody>
            {% for item in insights.products_not_sold_last_month %}
            <tr>
                <td>{{ item.ProductID }}</td>
                <td>{{ item.ProductName }}</td>
                <td>{{ item.Category }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Customers Without Recent Transactions (Past 1 Year)</h2>
    <table class="table table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Customer ID</th>
                <th>Name</th>
                <th>Email</th>
            </tr>
        </thead>
        <tbody>
            {% for item in insights.customers_without_recent_transactions %}
            <tr>
                <td>{{ item.CustomerID }}</td>
                <td>{{ item.Name }}</td>
                <td>{{ item.Email }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Please log in to view insights and analytics.</p>
    {% endif %}
</div>
{% endblock %}
